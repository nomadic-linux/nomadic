    <canvas id="canvas"></canvas>
    <h1 id="head">
    <% CONF["battlecab"]["stats"].each_pair do |e, s| %>
    <span class="head_item" ><span class="head_amt" id="<%= e %>"><%= s[1] %></span><span class="head_icon"><%= s[0] %></span></span>
    <% end %>
    </h1>
    <div id="rank">
    <span class="rank role"><%= if user(session[:user])[:lvl].to_i > 0; CONF["battlecab"]["levels"]["classes"][user(session[:user])[:role]][0]; end %></span>
    <span class="rank pips"><%= user(session[:user])[:pips] %></span>
    <span class="rank name"><%= user(session[:user])[:name] %></span>
    <span class="rank pips"><%= user(session[:user])[:pips] %></span>
    <span class="rank role"><%= if user(session[:user])[:lvl].to_i > 0; CONF["battlecab"]["levels"]["classes"][user(session[:user])[:role]][0]; end %></span>
    </div>
    <code><%= settings.conf %></code>
    <pre id="msg"></pre>
    <script src="battlecab/camo.js"></script>
<script>
    $(function() {
	function appendMessage(data) {
	    console.log("data: ", data);
	    console.log("msgs: ", data.msgs);
	    jQuery.each(data.msgs, function(i, j) {
		ee = JSON.parse(j);
		console.log("ee: ", i, j, ee);
                if ( ee.icon ) {                                                                                                                                                                          
                    $('#msg').prepend( "<div class='msg event " + ee.color + "'><p><span class='event_icon'>" + ee.icon + "</span><span class='event_message'>" + ee.message + "</span></p></div>");                                                        
                } else if ( ee.choices ) {                                                                                                                                                                  
                    $('#msg').prepend("<div class='msg choice " + ee.color + "'><h3 class='choice_message'>" + ee.message + "</h3>" + ee.choices);                                                                                     
                } else {
		$('#msg').prepend("<div class='msg " + ee.color + "'><p class='message'>" + ee.message + "</p></div>");	
		}
            });
	    console.log("state", data.state);
		<% CONF["battlecab"]["stats"].each_pair do |e, s| %>
		$("#<%= e %>").val(data.state.<%= e %>);
		<% end %>
		$('#rank').css('background-color', data.state.team);
	    $('#rank').css('color', data.state.color);
	    $('#rank').css('border-left-color',  + data.state.spec);
	    $('#rank').css('border-bottom-color', data.state.spec);
	    $('#rank').css('border-right-color', data.state.spec);
	    return data
	}
	
	    var src = new EventSource('/s/<%= session[:user] %>');
	src.onmessage =  function(e) { console.log("PUSH", e); j = JSON.parse(e.data); if (j.new == "true") { appendMessage(j); } }
	    setInterval( function() {
		jQuery.get( "/m/<%= session[:user] %>", function(e) { console.log("PING", e); j = JSON.parse(e.data); if (j.new == "true") { appendMessage(j); }});
	    } , 10000);
	jQuery.get( "/m/<%= session[:user] %>", function(e) { console.log("HDSK", e); j = JSON.parse(e.data); if (j.new == "true") { appendMessage(j); }});
    });
</script>
    <form action="/" method="post">
    <button id="end" type="submit" name="done">QUIT</button>
    </form>
