#!/bin/bash

source env.sh

if [ "$1" == "wipe" ]; then
    printf "wiping... "
    shift
    cd ~/
    rm -fR nomadic
    rm -fR cabage
    rm -fR bin
    rm -fR dwm
    rm .screenrc
    rm .irc.el
    redis-cli flushdb
    printf "wiped!"
    echo "Ctrl-c to stop..."
    sleep 10
fi

echo "##### OK"
echo ""
printf "[cabage] "
if [ ! -d ~/cabage ]; then
    printf "getting... "
    cd ~;
    git clone https://github.com/xorgnak/cabage && cd cabage && ./now;
    sudo cp work /bin/work
    printf "got! "
fi
printf "READY."
echo ""
printf "[gui] "
if [ $WORK_GUI == true ]; then
    if [ ! -d ~/dwm ]; then
	printf "getting... "
	cd ~;
	git clone https://github.com/xorgnak/dwm && cd dwm && ./now;
	printf "got! "
    fi
    printf "READY."
else
    printf "NONE."
fi

echo ""
printf "[rtc] "
if [ $WORK_RTC == true ]; then
    if [ `which peerjs` == '' ]; then
	printf "getting... "
	sudo apt install npm
	sudo npm install peer -g
	printf "got! "
    fi
    printf "READY."
else
    printf "NONE."
fi


echo ""
printf "[arduino] "
if [ $WORK_ARDUINO == true ]; then
    if [ ! -d  ~/.arduino15 ]; then
	printf "getting... "
	cd ~;
	curl -fsSL https://raw.githubusercontent.com/arduino/arduino-cli/master/install.sh | sh -;
	cd bin;
	./arduino-cli config init;
	editor ~/.arduino15/arduino-cli.yaml
	./arduino-cli core update-index;
	printf "got! "
    fi
    printf "READY."
else
    printf "NONE."
fi
echo ""
printf "[radio] "
if [ $WORK_RADIO == true ]; then
    if [ ! -d ~/radio ]; then
	printf "getting... "
	sudo apt install -y rtl-sdr fldigi wsjtx gqrx-srd;
	mkdir ~/radio
	printf "got! "
    fi
    printf "READY."
else
    printf "NONE."  
fi

echo ""
printf "[media] "
if [ $WORK_MEDIA == true ]; then
    if [ ! -d ~/video ]; then
	printf "getting... "
	cd ~;
	sudo apt install obs vlc
	mkdir ~/video
	printf "got! "
    fi
    printf "READY."
else
    printf "NONE."
fi


echo ""
echo "*** run './$0 configure' to update these settings."
echo "##### READY TO BEGIN"

if [ "$1" == "configure" ]; then
    sudo update-alternatives --config editor
    sudo update-alternatives --config x-terminal-emulator
    sudo update-alternatives --config x-www-browser
    editor env.sh
elif [ "$1" == '--help' ] || [ "$1" == "help" ] || [ "$1" == "-h" ]; then
    echo "usage: ./$0 [configure]"
    echo " configure: edit environment"
    echo "else"
    echo "- run cabage"
else
    cd ~/cabage && ./now $*;    
fi
echo "##### GOODBYE"
